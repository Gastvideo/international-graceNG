<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>International Grace</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin:0; padding:0;
    background: url('flowers.jpg') no-repeat center center fixed;
    background-size: cover; color:#fff;
  }
  .container { width: 80%; margin:auto; text-align:center; padding:20px; }
  .hidden { display:none; }
  button, input { padding:12px 15px; margin:5px; border-radius:8px; border:none; font-size:1.2em; }
  button { background:#ff9800; color:#fff; font-weight:bold; cursor:pointer; }
  .salle { background: rgba(0,0,0,0.6); margin:20px auto; padding:20px; border-radius:10px; font-size:1.3em; }
  #chat { width:100%; max-width:600px; margin:20px auto; border:1px solid #ccc; background:#fff; color:#000; height:400px; overflow-y:auto; padding:10px; border-radius:10px; }
  #inputChat { display:flex; justify-content:center; gap:10px; }
  #inputChat input[type="text"] { flex:1; font-size:1em; }
  .langSwitch { position: absolute; top: 10px; right: 10px; }
</style>
</head>
<body>
<div class="container">

  <!-- Language Switch -->
  <div class="langSwitch">
    <button onclick="setLang('fr')">FR</button>
    <button onclick="setLang('en')">EN</button>
  </div>

  <!-- Home Page -->
  <div id="homePage">
    <h1 style="font-size:3em; color:#fff; text-shadow:2px 2px 4px #000;">Bienvenue sur International Grace</h1>
    <p style="font-size:1.5em; color:#fff; text-shadow:1px 1px 2px #000;">Choisissez une option pour commencer :</p>
    <button onclick="showAuth()">S’inscrire / Se connecter</button>
  </div>

  <!-- Auth Page -->
  <div id="authPage" class="hidden">
    <h2 id="authTitle">Inscription</h2>
    <input type="text" id="regName" placeholder="Nom complet"><br>
    <input type="email" id="regEmail" placeholder="Email"><br>
    <input type="password" id="regPass" placeholder="Mot de passe"><br>
    <button onclick="register()">S’inscrire</button>
    <h2 id="loginTitle">Connexion</h2>
    <input type="email" id="logEmail" placeholder="Email"><br>
    <input type="password" id="logPass" placeholder="Mot de passe"><br>
    <button onclick="login()">Se connecter</button>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden">
    <h1 id="dashboardTitle">Tableau de bord</h1>
    <p id="welcomeMsg">Bienvenue, <span id="userName"></span> !</p>

    <div class="salle">
      <h2 id="venteTitle">Salle Vente</h2>
      <button onclick="joinSalle('vente')">Rejoindre</button>
    </div>
    <div class="salle">
      <h2 id="entraideTitle">Salle Rencontre & Entraide</h2>
      <button onclick="joinSalle('entraide')">Rejoindre</button>
    </div>
    <div class="salle">
      <h2 id="formationTitle">Salle Formation</h2>
      <button onclick="joinSalle('formation')">Rejoindre</button>
    </div>
    <div class="salle">
      <h2 id="emploiTitle">Salle Emploi & Recrutement</h2>
      <button onclick="joinSalle('emploi')">Rejoindre</button>
    </div>
  </div>

  <!-- Salle Page -->
  <div id="sallePage" class="hidden">
    <h1 id="salleTitle"></h1>
    <button onclick="backToDashboard()">⬅ Retour</button>
    <div id="chat"></div>
    <div id="inputChat">
      <input type="text" id="message" placeholder="Écrire un message...">
      <input type="file" id="fileInput" accept="image/*,video/*">
      <button onclick="sendMessage()">Envoyer</button>
    </div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyAScFGLnInmQIH3rMeQPA8Pq5JFEvQeOaw",
  authDomain: "international-grace-app.firebaseapp.com",
  projectId: "international-grace-app",
  storageBucket: "international-grace-app.firebasestorage.app",
  messagingSenderId: "198454951680",
  appId: "1:198454951680:web:c84ed34849216a0ad4fde5"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const storage = getStorage(app);

let currentUser = null;
let currentSalle = null;
let lang = 'fr';

// Fonction pour changer la langue
function setLang(l) {
  lang = l;
  if(l==='fr'){
    document.getElementById("authTitle").innerText="Inscription";
    document.getElementById("loginTitle").innerText="Connexion";
    document.getElementById("dashboardTitle").innerText="Tableau de bord";
    document.getElementById("venteTitle").innerText="Salle Vente";
    document.getElementById("entraideTitle").innerText="Salle Rencontre & Entraide";
    document.getElementById("formationTitle").innerText="Salle Formation";
    document.getElementById("emploiTitle").innerText="Salle Emploi & Recrutement";
    document.getElementById("welcomeMsg").innerHTML=`Bienvenue, <span id="userName"></span> !`;
    document.getElementById("homePage").querySelector('p').innerText="Choisissez une option pour commencer :";
    document.getElementById("homePage").querySelector('button').innerText="S’inscrire / Se connecter";
  } else {
    document.getElementById("authTitle").innerText="Register";
    document.getElementById("loginTitle").innerText="Login";
    document.getElementById("dashboardTitle").innerText="Dashboard";
    document.getElementById("venteTitle").innerText="Sales Room";
    document.getElementById("entraideTitle").innerText="Friendship & Help Room";
    document.getElementById("formationTitle").innerText="Training Room";
    document.getElementById("emploiTitle").innerText="Job & Recruitment Room";
    document.getElementById("welcomeMsg").innerHTML=`Welcome, <span id="userName"></span> !`;
    document.getElementById("homePage").querySelector('p').innerText="Choose an option to start:";
    document.getElementById("homePage").querySelector('button').innerText="Register / Login";
  }
}

// Afficher page d'auth
window.showAuth = function(){
  document.getElementById("homePage").classList.add("hidden");
  document.getElementById("authPage").classList.remove("hidden");
}

// Inscription
window.register = function() {
  const name = document.getElementById("regName").value;
  const email = document.getElementById("regEmail").value;
  const pass = document.getElementById("regPass").value;
  if(name && email && pass){
    localStorage.setItem("user_"+email, JSON.stringify({name, pass}));
    alert(lang==='fr'?"Inscription réussie !":"Registration successful!");
  } else { alert(lang==='fr'?"Remplissez tous les champs.":"Fill all fields."); }
}

// Connexion
window.login = function() {
  const email = document.getElementById("logEmail").value;
  const pass = document.getElementById("logPass").value;
  let user = localStorage.getItem("user_"+email);
  if(user){
    user = JSON.parse(user);
    if(user.pass === pass){
      currentUser = user;
      document.getElementById("authPage").classList.add("hidden");
      document.getElementById("dashboard").classList.remove("hidden");
      document.getElementById("userName").innerText = user.name;
    } else { alert(lang==='fr'?"Mot de passe incorrect.":"Incorrect password."); }
  } else { alert(lang==='fr'?"Utilisateur introuvable.":"User not found."); }
}

// Paiement mobile + code confirmation
window.joinSalle = function(type){
  const paiement = confirm(lang==='fr'?
    "Pour accéder à cette salle, payez 2000F via Mobile Money.\nNuméros : +229 0154992775 / +229 0168036302\nCliquez OK après paiement." :
    "To access this room, pay 2000F via Mobile Money.\nNumbers: +229 0154992775 / +229 0168036302\nClick OK after payment."
  );
  if(!paiement){ alert(lang==='fr'?"Accès refusé, paiement non effectué.":"Access denied, payment not done."); return; }

  const codeSecret = Math.floor(1000 + Math.random()*9000);
  const userCode = prompt(lang==='fr'?
    "Entrez ce code de confirmation pour accéder à la salle : "+codeSecret :
    "Enter this confirmation code to access the room: "+codeSecret
  );
  if(userCode != codeSecret){ alert(lang==='fr'?"Code incorrect. Accès refusé !":"Incorrect code. Access denied!"); return; }

  currentSalle = type;
  document.getElementById("dashboard").classList.add("hidden");
  document.getElementById("sallePage").classList.remove("hidden");
  document.getElementById("salleTitle").innerText = (lang==='fr'?"Salle : ":"Room: ") + type;
  loadMessages(type);
}

// Retour
window.backToDashboard = function(){
  document.getElementById("sallePage").classList.add("hidden");
  document.getElementById("dashboard").classList.remove("hidden");
}

// Envoyer message
window.sendMessage = function(){
  const text = document.getElementById("message").value;
  const file = document.getElementById("fileInput").files[0];
  if(!currentSalle){ alert("No room selected"); return; }
  if(text.trim() !== ""){
    push(ref(db,"salles/"+currentSalle), { user: currentUser.name, text, time: Date.now() });
  }
  if(file){
    const storageRef = sRef(storage, "uploads/"+Date.now()+"_"+file.name);
    uploadBytes(storageRef,file).then(()=>{
      getDownloadURL(storageRef).then(url=>{
        push(ref(db,"salles/"+currentSalle), { user: currentUser.name, media:url, type:file.type.startsWith("image/")?"image":"video", time: Date.now() });
      });
    });
  }
  document.getElementById("message").value="";
  document.getElementById("fileInput").value="";
}

// Charger messages
function loadMessages(salle){
  const chat = document.getElementById("chat");
  chat.innerHTML="";
  onChildAdded(ref(db,"salles/"+salle), snapshot=>{
    const msg = snapshot.val();
    let el = document.createElement("div");
    el.style.margin="10px 0";
    if(msg.text) el.innerHTML=`<b>${msg.user}:</b> ${msg.text}`;
    if(msg.media){
      if(msg.type==="image") el.innerHTML+=`<br><img src="${msg.media}" width="200">`;
      if(msg.type==="video") el.innerHTML+=`<br><video width="200" controls><source src="${msg.media}"></video>`;
    }
    chat.appendChild(el);
    chat.scrollTop = chat.scrollHeight;
  });
}

</script
